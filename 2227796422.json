{
  "SaveName": "Fog-of-War Chips",
  "GameMode": "Quicksave",
  "Date": "9/13/2020 3:44:45 PM",
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "GameType": "",
  "GameComplexity": "",
  "Tags": [],
  "Table": "Table_Octagon",
  "Sky": "Sky_Downtown",
  "Note": "",
  "Rules": "",
  "Grid": {
    "Type": 0,
    "Lines": false,
    "Color": {
      "r": 0.0,
      "g": 0.0,
      "b": 0.0
    },
    "Opacity": 0.75,
    "ThickLines": false,
    "Snapping": false,
    "Offset": false,
    "BothSnapping": false,
    "xSize": 2.0,
    "ySize": 2.0,
    "PosOffset": {
      "x": 0.0,
      "y": 1.0,
      "z": 0.0
    }
  },
  "Lighting": {
    "LightIntensity": 0.54,
    "LightColor": {
      "r": 1.0,
      "g": 0.9804,
      "b": 0.8902
    },
    "AmbientIntensity": 1.3,
    "AmbientType": 0,
    "AmbientSkyColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientEquatorColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientGroundColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "ReflectionIntensity": 1.0,
    "LutIndex": 0,
    "LutContribution": 1.0
  },
  "Hands": {
    "Enable": true,
    "DisableUnused": false,
    "Hiding": 0,
    "HandTransforms": [
      {
        "Color": "Red",
        "Transform": {
          "posX": -12.3078938,
          "posY": 3.66349268,
          "posZ": -12.4467239,
          "rotX": 0.0,
          "rotY": 45.0000038,
          "rotZ": 0.0,
          "scaleX": 9.413998,
          "scaleY": 8.96114,
          "scaleZ": 5.465847
        }
      },
      {
        "Color": "Yellow",
        "Transform": {
          "posX": -12.3997517,
          "posY": 3.6634984,
          "posZ": 12.199688,
          "rotX": 0.0,
          "rotY": 135.0,
          "rotZ": 0.0,
          "scaleX": 9.414545,
          "scaleY": 8.96114,
          "scaleZ": 5.46615839
        }
      },
      {
        "Color": "Purple",
        "Transform": {
          "posX": 17.3902683,
          "posY": 3.663497,
          "posZ": 0.044939518,
          "rotX": 0.0,
          "rotY": 270.0,
          "rotZ": 0.0,
          "scaleX": 9.414305,
          "scaleY": 8.96114,
          "scaleZ": 5.466003
        }
      },
      {
        "Color": "Blue",
        "Transform": {
          "posX": 12.36914,
          "posY": 3.66349554,
          "posZ": 12.2303085,
          "rotX": 0.0,
          "rotY": 224.999985,
          "rotZ": 0.0,
          "scaleX": 9.414168,
          "scaleY": 8.96114,
          "scaleZ": 5.465942
        }
      },
      {
        "Color": "White",
        "Transform": {
          "posX": 4.76837158E-06,
          "posY": 3.66349745,
          "posZ": -17.3453884,
          "rotX": 0.0,
          "rotY": 0.0,
          "rotZ": 0.0,
          "scaleX": 9.414002,
          "scaleY": 8.96114,
          "scaleZ": 5.46584272
        }
      },
      {
        "Color": "Green",
        "Transform": {
          "posX": -1.43051147E-06,
          "posY": 3.66349554,
          "posZ": 17.1985016,
          "rotX": 0.0,
          "rotY": 179.8,
          "rotZ": 0.0,
          "scaleX": 9.414276,
          "scaleY": 8.96114,
          "scaleZ": 5.466095
        }
      },
      {
        "Color": "Pink",
        "Transform": {
          "posX": 12.3691339,
          "posY": 3.663496,
          "posZ": -12.1405659,
          "rotX": 0.0,
          "rotY": 315.0,
          "rotZ": 0.0,
          "scaleX": 9.414021,
          "scaleY": 8.96114,
          "scaleZ": 5.46587658
        }
      },
      {
        "Color": "Orange",
        "Transform": {
          "posX": -17.4208832,
          "posY": 3.663496,
          "posZ": -0.169384956,
          "rotX": 0.0,
          "rotY": 90.0,
          "rotZ": 0.0,
          "scaleX": 9.414293,
          "scaleY": 8.96114,
          "scaleZ": 5.465992
        }
      }
    ]
  },
  "Turns": {
    "Enable": false,
    "Type": 0,
    "TurnOrder": [],
    "Reverse": false,
    "SkipEmpty": false,
    "DisableInteractions": false,
    "PassTurns": true,
    "TurnColor": ""
  },
  "TabStates": {
    "0": {
      "title": "Rules",
      "body": "",
      "color": "Grey",
      "visibleColor": {
        "r": 0.5,
        "g": 0.5,
        "b": 0.5
      },
      "id": 0
    },
    "1": {
      "title": "White",
      "body": "",
      "color": "White",
      "visibleColor": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "id": 1
    },
    "2": {
      "title": "Brown",
      "body": "",
      "color": "Brown",
      "visibleColor": {
        "r": 0.443,
        "g": 0.231,
        "b": 0.09
      },
      "id": 2
    },
    "3": {
      "title": "Red",
      "body": "",
      "color": "Red",
      "visibleColor": {
        "r": 0.856,
        "g": 0.1,
        "b": 0.094
      },
      "id": 3
    },
    "4": {
      "title": "Orange",
      "body": "",
      "color": "Orange",
      "visibleColor": {
        "r": 0.956,
        "g": 0.392,
        "b": 0.113
      },
      "id": 4
    },
    "5": {
      "title": "Yellow",
      "body": "",
      "color": "Yellow",
      "visibleColor": {
        "r": 0.905,
        "g": 0.898,
        "b": 0.172
      },
      "id": 5
    },
    "6": {
      "title": "Green",
      "body": "",
      "color": "Green",
      "visibleColor": {
        "r": 0.192,
        "g": 0.701,
        "b": 0.168
      },
      "id": 6
    },
    "7": {
      "title": "Blue",
      "body": "",
      "color": "Blue",
      "visibleColor": {
        "r": 0.118,
        "g": 0.53,
        "b": 1.0
      },
      "id": 7
    },
    "8": {
      "title": "Teal",
      "body": "",
      "color": "Teal",
      "visibleColor": {
        "r": 0.129,
        "g": 0.694,
        "b": 0.607
      },
      "id": 8
    },
    "9": {
      "title": "Purple",
      "body": "",
      "color": "Purple",
      "visibleColor": {
        "r": 0.627,
        "g": 0.125,
        "b": 0.941
      },
      "id": 9
    },
    "10": {
      "title": "Pink",
      "body": "",
      "color": "Pink",
      "visibleColor": {
        "r": 0.96,
        "g": 0.439,
        "b": 0.807
      },
      "id": 10
    },
    "11": {
      "title": "Black",
      "body": "",
      "color": "Black",
      "visibleColor": {
        "r": 0.25,
        "g": 0.25,
        "b": 0.25
      },
      "id": 11
    }
  },
  "DecalPallet": [],
  "ObjectStates": [
    {
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": -0.0500675,
        "posY": 0.9429997,
        "posZ": -0.05791046,
        "rotX": -3.44534737E-06,
        "rotY": -0.00011652377,
        "rotZ": -3.5710907E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "FoW Chips",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.243136972,
        "g": 0.243136972,
        "b": 0.243136972
      },
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "Name": "backgammon_piece_white",
          "Transform": {
            "posX": -1.244169,
            "posY": 3.091676,
            "posZ": 4.477097,
            "rotX": 7.166595,
            "rotY": 0.1195466,
            "rotZ": 1.73389471,
            "scaleX": 1.0,
            "scaleY": 1.0,
            "scaleZ": 1.0
          },
          "Nickname": "FoW - ",
          "Description": "This chip is responsible for creating/destroying Fog of War zones",
          "GMNotes": "",
          "ColorDiffuse": {
            "r": 0.2431367,
            "g": 0.2431367,
            "b": 0.2431367
          },
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "LuaScript": "-- GUID of the FoW zone this handler handles\nfowGuid = nil\n-- Flag telling whether or not the save timer is running\ntimerIsRunning = false\n\n-- Handler for the object's load event\nfunction onload()\n    -- Check if there are any saved data in the GM notes\n    local isSetup = false\n    local saved_data = self.getGMNotes()\n    if saved_data ~= \"\" then\n        -- Try to set up the zone from the saved data\n        isSetup = pcall(initFromSavedData, saved_data)\n\n        -- If the initialization failed, notify the user\n        if not isSetup then\n            print(\"Could not load FoW zone from storage\")\n        end\n    end\n\n    -- If the FoW zone has not been set up for some reason, show the setup button\n    if not isSetup then\n        createSetupButton()\n    end\nend\n\n-- Handler for the object's destroy event\nfunction onDestroy()\n    -- Destroy the linked FoW zone\n    destroyFoWZone()\n\n    -- Stop the save timer\n    stopSaveTimer()\nend\n\n-- Destroys the linked FoW zone. Does nothing if it does not exist\nfunction destroyFoWZone()\n    local fowZone = getObjectFromGUID(fowGuid)\n    if fowZone ~= nil then\n        fowZone.destruct()\n    end\nend\n\n-- Initializes the FoW zone from saved data\nfunction initFromSavedData(saved_data)\n    -- Parse it as JSON\n    local loaded_data = JSON.decode(saved_data)\n\n    -- Check if the linked zone exists, and create it if it doesn't\n    local fowZone = getObjectFromGUID(loaded_data.fowGuid)\n    if fowZone == nil then\n        spawnFromJSON(loaded_data.json)\n    else\n        fowGuid = fowZone.getGUID()\n    end\nend\n\n-- Makes the setup button\nfunction createSetupButton()\n    self.clearButtons()\n    self.createButton({\n        label = \"Setup\",\n        click_function = \"buttonClick_setup\",\n        function_owner = self,\n        position = {0,0.3,0},\n        rotation = {0,180,0},\n        height = 350,\n        width = 800,\n        font_size = 250,\n        color = {0,0,0},\n        font_color = {1,1,1}\n    })\nend\n\n-- Handles clicks on the setup button\nfunction buttonClick_setup()\n    -- Lock the object so it isn't accidently moved. All the FoW buttons will move with it if it is\n    self.setLock(true)\n\n    -- Remove all existing buttons\n    self.clearButtons()\n\n    -- Create new buttons over each FoW zone\n    createButtonsOnAllFoWObjects()\nend\n\n-- Makes the save button\nfunction createSaveButton()\n    self.clearButtons()\n    self.createButton({\n        label = \"Save\",\n        click_function = \"buttonClick_save\",\n        function_owner = self,\n        position = {0,0.3,0},\n        rotation = {0,180,0},\n        height = 350,\n        width = 800,\n        font_size = 250,\n        color = {0,0,0},\n        font_color = {1,1,1}\n    })\nend\n\n-- Handles clicks on the save button\nfunction buttonClick_save()\n    saveState()\n    print(\"FoW state saved\")\nend\n\n--Creates selection buttons on FoW zones. Mostly copied from the workshop item \"FoW on a tray\"\nfunction createButtonsOnAllFoWObjects()\n    local numberOfButtons = 0\n    for _, obj in ipairs(getAllObjects()) do\n        if obj.name == \"FogOfWar\" then\n            numberOfButtons = numberOfButtons+1\n            local objGUID = obj.getGUID()\n            --On a normal bag, the button positions aren't the same size as the bag.\n            globalScaleFactor = 1 * 1/self.getScale().x\n            --Super sweet math to set button positions\n            local selfPos = self.getPosition()\n            local objPos = obj.getPosition()\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\n            local objPos = rotateLocalCoordinates(deltaPos, self)\n            objPos.x = -objPos.x * globalScaleFactor\n            objPos.y = objPos.y * globalScaleFactor\n            objPos.z = objPos.z * globalScaleFactor\n            --Offset rotation of bag\n            local rot = self.getRotation()\n            rot.y = -rot.y + 180\n            --Create the button\n            local funcName = \"selectButton_\" .. objGUID\n            local func = function() linkWithFoWZone(objGUID) end\n            self.setVar(funcName, func)\n            self.createButton({\n                click_function=funcName,\n                function_owner=self,\n                position=objPos,\n                rotation=rot,\n                height=500,\n                width=500,\n                color={0.75,0.25,0.25,0.6},\n            })\n        end\n    end\n\n    if numberOfButtons == 0 then\n        print(\"No FoW zones found\")\n        createSetupButton()\n    end\nend\n\n--Find delta (difference) between 2 x/y/z coordinates. Copied from the workshop item \"FoW on a tray\"\nfunction findOffsetDistance(p1, p2, obj)\n    local deltaPos = {}\n    local bounds = obj.getBounds()\n    deltaPos.x = (p2.x-p1.x)\n    deltaPos.y = (p2.y-p1.y) + (bounds.size.y - bounds.offset.y)\n    deltaPos.z = (p2.z-p1.z)\n    return deltaPos\nend\n\n--Used to rotate a set of coordinates by an angle. Copied from the workshop item \"FoW on a tray\"\nfunction rotateLocalCoordinates(desiredPos, obj)\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\n    local angle = math.rad(objRot.y)\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\n    return {x=x, y=desiredPos.y, z=z}\nend\n\n-- Spawns a FoW zone from a JSON string and links it to this object\nfunction spawnFromJSON(json)\n    -- If created immediately, some timing issue with One World causes other objects to be hidden, even when in a revealed part of the FoW. Compensate by waiting a bit before creating the zone\n    Wait.frames(function()\n        spawnObjectJSON({\n            json = json,\n            callback_function = function(obj) linkWithFoWZone(obj.getGUID()) end\n        })\n    end, 30)\nend\n\n--Links the FoW handler with a FoW zone\nfunction linkWithFoWZone(guid)\n    -- Store the zone's GUID\n    fowGuid = guid\n\n    -- Change the buttons\n    self.clearButtons()\n    createSaveButton()\n\n    -- Save the zone's state and start the save timer\n    saveState()\n    startSaveTimer()\nend\n\n-- Starts the saving timer, if it is not already running\nfunction startSaveTimer()\n    if not timerIsRunning then\n        timerIsRunning = true\n        Timer.create({\n            identifier = self.getGUID(),\n            repetitions = 0, -- Infinite\n            function_name = \"saveState\",\n            delay = 60\n        })\n    end\nend\n\n-- Stops the saving timer, if it is running\nfunction stopSaveTimer()\n    if timerIsRunning then\n        Timer.destroy(self.getGUID())\n        timerIsRunning = false\n    end\nend\n\n-- Saves the state of the FoW zone to the GM description of the handler\nfunction saveState()\n    local fowZone = getObjectFromGUID(fowGuid)\n    if fowZone ~= nil then\n        self.setGMNotes(JSON.encode({\n           fowGuid = fowGuid,\n           json = fowZone.getJSON()\n        }))\n    else\n        print(\"Could not find FoW zone linked to \\\"\" .. self.getName() .. \"\\\". Was it deleted? If that was intended, please also delete the corresponding FoW token\")\n        stopSaveTimer()\n    end\nend\n",
          "LuaScriptState": "",
          "XmlUI": "",
          "GUID": "d7607e"
        }
      ],
      "GUID": "7c9dbf"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": -3.66293168,
        "posY": 1.03000021,
        "posZ": 9.87987,
        "rotX": -2.61737955E-06,
        "rotY": 0.01492269,
        "rotZ": 5.675016E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Fog-of-War Chips 1/2",
      "Description": "The chips in this bag have the power to create and destroy Fog-of-War (FoW) zones.\n\nFirst, you need to set them up. Create a FoW zone, pick a chip from the bag, and click \"Setup\" on the chip. A red button then appears on the FoW zone. Click it, and the zone is linked to the chip!\n\nThe chip does not need to be in the zone",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "351805"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": 3.73426127,
        "posY": 1.03000045,
        "posZ": 9.885771,
        "rotX": 8.099121E-06,
        "rotY": 0.007034966,
        "rotZ": 4.541111E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Fog-of-War Chips 2/2",
      "Description": "After linking a chip to a FoW zone, the zone will be destroyed then the chip is put in a bag or otherwise removed from the game.\n\nThe FoW zone will be recreated once the chip starts existing again, for example when being pulled out from a bag\n\nYou should name the chips so you know what they control, but it is not necessary",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "84d9f3"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": 3.77967882,
        "posY": 1.03,
        "posZ": 5.20159245,
        "rotX": -1.045502E-05,
        "rotY": 0.0202833,
        "rotZ": -2.67247287E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "One World Compatible!",
      "Description": "Place a FoW zone on the big map in One World. Place a chip on the map. Link the chip to the zone, and pack it.\nThe FoW zone will then be created when the map is loaded, and be removed when it is unloaded again!\n\nNote that you must click \"Save\" on the chip, and the map must be packed for the state of the zone to be saved",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "46cb78"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": -3.70964479,
        "posY": 1.03,
        "posZ": 5.205129,
        "rotX": -4.70210671E-06,
        "rotY": -0.000357692858,
        "rotZ": 1.900152E-08,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Saving the FoW zone",
      "Description": "The chip runs a timer, automatically saving the state of the zone every minute.\n\nIn addition, the chip has a button \"Save\", which manually saves the zone's state when clicked\n\nIt is recommended to always click \"Save\" before packing the chip away.",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "213132"
    }
  ],
  "LuaScript": "--[[ Lua code. See documentation: https://api.tabletopsimulator.com/ --]]\n\n--[[ The onLoad event is called after the game save finishes loading. --]]\nfunction onLoad()\n    --[[ print('onLoad!') --]]\nend\n\n--[[ The onUpdate event is called once per frame. --]]\nfunction onUpdate()\n    --[[ print('onUpdate loop!') --]]\nend",
  "LuaScriptState": "",
  "XmlUI": "<!-- Xml UI. See documentation: https://api.tabletopsimulator.com/ui/introUI/ -->",
  "VersionNumber": "v12.4.3"
}