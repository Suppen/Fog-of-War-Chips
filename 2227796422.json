{
  "SaveName": "Fog-of-War Chips",
  "GameMode": "Fog-of-War Chips",
  "Date": "9/13/2020 12:54:15 PM",
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "GameType": "Utility",
  "GameComplexity": "Low Complexity",
  "PlayingTime": [
    0,
    0
  ],
  "PlayerCounts": [
    0,
    0
  ],
  "Tags": [
    "Role-playing Games"
  ],
  "Table": "Table_Octagon",
  "Sky": "Sky_Cathedral",
  "Note": "",
  "Rules": "",
  "MusicPlayer": {
    "RepeatSong": true,
    "PlaylistEntry": 1,
    "CurrentAudioTitle": "Forest Night",
    "CurrentAudioURL": "http://cloud-3.steamusercontent.com/ugc/767229411676593027/61F5B429737F150D1F6F9EB7EE64BA79660445D4/",
    "AudioLibrary": [
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676584547/27284C343EFEEAEF9F0FD9CB31C7A72B2C5865B4/",
        "Item2": "Volatile Reaction"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676593027/61F5B429737F150D1F6F9EB7EE64BA79660445D4/",
        "Item2": "Forest Night"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676596089/44E157D4B0A70BE02D7BD336055A16C71E00B82B/",
        "Item2": "Sleeping Dragon"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676598530/C4B4B85B53068C8DAFA0EC45B7EFDF2CB0D17C38/",
        "Item2": "Field of Heroes"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676601776/F98BAC115279E429BCEF74E8E6B23A66AFAF0988/",
        "Item2": "Forest Day"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676612791/F062CE72D4379C739F33334B5D6EF2742BCFFC6C/",
        "Item2": "Heart of Nowhere"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676614058/36D69D94AD943FEB90C4172FCB30E80D6B74AFBD/",
        "Item2": "Satiate"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676904926/F880D11D82006396CBB08E1803EA1B3256C16569/",
        "Item2": "City Music"
      },
      {
        "Item1": "http://cloud-3.steamusercontent.com/ugc/767229411676586125/EDE64AF16ABAF9A0B58102E827B3D5F7ADD68A46/",
        "Item2": "Oppresive Gloom"
      }
    ]
  },
  "Grid": {
    "Type": 0,
    "Lines": false,
    "Color": {
      "r": 0.0,
      "g": 0.0,
      "b": 0.0
    },
    "Opacity": 0.75,
    "ThickLines": false,
    "Snapping": false,
    "Offset": false,
    "BothSnapping": false,
    "xSize": 2.0,
    "ySize": 2.0,
    "PosOffset": {
      "x": 0.0,
      "y": 1.0,
      "z": 0.0
    }
  },
  "Lighting": {
    "LightIntensity": 0.54,
    "LightColor": {
      "r": 1.0,
      "g": 0.9804,
      "b": 0.8902
    },
    "AmbientIntensity": 1.3,
    "AmbientType": 0,
    "AmbientSkyColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientEquatorColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientGroundColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "ReflectionIntensity": 1.0,
    "LutIndex": 0,
    "LutContribution": 1.0
  },
  "Hands": {
    "Enable": true,
    "DisableUnused": false,
    "Hiding": 0,
    "HandTransforms": [
      {
        "Color": "Red",
        "Transform": {
          "posX": -12.3078938,
          "posY": 3.66349268,
          "posZ": -12.4467239,
          "rotX": 0.0,
          "rotY": 45.0000038,
          "rotZ": 0.0,
          "scaleX": 9.413998,
          "scaleY": 8.96114,
          "scaleZ": 5.465847
        }
      },
      {
        "Color": "Yellow",
        "Transform": {
          "posX": -12.3997517,
          "posY": 3.6634984,
          "posZ": 12.199688,
          "rotX": 0.0,
          "rotY": 135.0,
          "rotZ": 0.0,
          "scaleX": 9.417301,
          "scaleY": 8.96114,
          "scaleZ": 5.46772671
        }
      },
      {
        "Color": "Purple",
        "Transform": {
          "posX": 17.3902683,
          "posY": 3.663497,
          "posZ": 0.044939518,
          "rotX": 0.0,
          "rotY": 270.0,
          "rotZ": 0.0,
          "scaleX": 9.415704,
          "scaleY": 8.96114,
          "scaleZ": 5.46671963
        }
      },
      {
        "Color": "Blue",
        "Transform": {
          "posX": 12.36914,
          "posY": 3.66349554,
          "posZ": 12.2303085,
          "rotX": 0.0,
          "rotY": 224.999985,
          "rotZ": 0.0,
          "scaleX": 9.41509151,
          "scaleY": 8.96114,
          "scaleZ": 5.46647739
        }
      },
      {
        "Color": "White",
        "Transform": {
          "posX": 4.76837158E-06,
          "posY": 3.66349745,
          "posZ": -17.3453884,
          "rotX": 0.0,
          "rotY": 0.0,
          "rotZ": 0.0,
          "scaleX": 9.414002,
          "scaleY": 8.96114,
          "scaleZ": 5.46584272
        }
      },
      {
        "Color": "Green",
        "Transform": {
          "posX": -1.43051147E-06,
          "posY": 3.66349554,
          "posZ": 17.1985016,
          "rotX": 0.0,
          "rotY": 179.8,
          "rotZ": 0.0,
          "scaleX": 9.41551,
          "scaleY": 8.96114,
          "scaleZ": 5.46727657
        }
      },
      {
        "Color": "Pink",
        "Transform": {
          "posX": 12.3691339,
          "posY": 3.663496,
          "posZ": -12.1405659,
          "rotX": 0.0,
          "rotY": 315.0,
          "rotZ": 0.0,
          "scaleX": 9.414021,
          "scaleY": 8.96114,
          "scaleZ": 5.46587658
        }
      },
      {
        "Color": "Orange",
        "Transform": {
          "posX": -17.4208832,
          "posY": 3.663496,
          "posZ": -0.169384956,
          "rotX": 0.0,
          "rotY": 90.0,
          "rotZ": 0.0,
          "scaleX": 9.415577,
          "scaleY": 8.96114,
          "scaleZ": 5.46662855
        }
      }
    ]
  },
  "Turns": {
    "Enable": false,
    "Type": 0,
    "TurnOrder": [],
    "Reverse": false,
    "SkipEmpty": false,
    "DisableInteractions": false,
    "PassTurns": true,
    "TurnColor": ""
  },
  "TabStates": {
    "0": {
      "title": "Rules",
      "body": "",
      "color": "Grey",
      "visibleColor": {
        "r": 0.5,
        "g": 0.5,
        "b": 0.5
      },
      "id": 0
    },
    "1": {
      "title": "White",
      "body": "",
      "color": "White",
      "visibleColor": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "id": 1
    },
    "2": {
      "title": "Brown",
      "body": "",
      "color": "Brown",
      "visibleColor": {
        "r": 0.443,
        "g": 0.231,
        "b": 0.09
      },
      "id": 2
    },
    "3": {
      "title": "Red",
      "body": "",
      "color": "Red",
      "visibleColor": {
        "r": 0.856,
        "g": 0.1,
        "b": 0.094
      },
      "id": 3
    },
    "4": {
      "title": "Orange",
      "body": "",
      "color": "Orange",
      "visibleColor": {
        "r": 0.956,
        "g": 0.392,
        "b": 0.113
      },
      "id": 4
    },
    "5": {
      "title": "Yellow",
      "body": "",
      "color": "Yellow",
      "visibleColor": {
        "r": 0.905,
        "g": 0.898,
        "b": 0.172
      },
      "id": 5
    },
    "6": {
      "title": "Green",
      "body": "",
      "color": "Green",
      "visibleColor": {
        "r": 0.192,
        "g": 0.701,
        "b": 0.168
      },
      "id": 6
    },
    "7": {
      "title": "Blue",
      "body": "",
      "color": "Blue",
      "visibleColor": {
        "r": 0.118,
        "g": 0.53,
        "b": 1.0
      },
      "id": 7
    },
    "8": {
      "title": "Teal",
      "body": "",
      "color": "Teal",
      "visibleColor": {
        "r": 0.129,
        "g": 0.694,
        "b": 0.607
      },
      "id": 8
    },
    "9": {
      "title": "Purple",
      "body": "",
      "color": "Purple",
      "visibleColor": {
        "r": 0.627,
        "g": 0.125,
        "b": 0.941
      },
      "id": 9
    },
    "10": {
      "title": "Pink",
      "body": "",
      "color": "Pink",
      "visibleColor": {
        "r": 0.96,
        "g": 0.439,
        "b": 0.807
      },
      "id": 10
    },
    "11": {
      "title": "Black",
      "body": "",
      "color": "Black",
      "visibleColor": {
        "r": 0.25,
        "g": 0.25,
        "b": 0.25
      },
      "id": 11
    }
  },
  "DecalPallet": [],
  "ObjectStates": [
    {
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": 0.105532035,
        "posY": 0.942999661,
        "posZ": 0.301527977,
        "rotX": 5.54418136E-07,
        "rotY": -2.2477021E-05,
        "rotZ": 7.82084555E-07,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "FoW chips",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.245644629,
        "g": 0.245644629,
        "b": 0.245644629
      },
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "Name": "backgammon_piece_white",
          "Transform": {
            "posX": -1.11118162,
            "posY": 3.13860154,
            "posZ": -3.24398375,
            "rotX": 6.173053,
            "rotY": 359.943359,
            "rotZ": 359.098145,
            "scaleX": 1.0,
            "scaleY": 1.0,
            "scaleZ": 1.0
          },
          "Nickname": "FoW - ",
          "Description": "This chip is responsible for creating/destroying Fog of War zones",
          "GMNotes": "",
          "ColorDiffuse": {
            "r": 0.243137211,
            "g": 0.243137211,
            "b": 0.243137211
          },
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "LuaScript": "-- GUID of the FoW zone this handler handles\nfowGuid = nil\n-- Flag telling whether or not the save timer is running\ntimerIsRunning = false\n\n-- Handler for the object's load event\nfunction onload()\n    -- Check if there are any saved data in the GM notes\n    local isSetup = false\n    local saved_data = self.getGMNotes()\n    if saved_data ~= \"\" then\n        -- Try to set up the zone from the saved data\n        isSetup = pcall(initFromSavedData, saved_data)\n\n        -- If the initialization failed, notify the user\n        if not isSetup then\n            print(\"Could not load FoW zone from storage\")\n        end\n    end\n\n    -- If the FoW zone has not been set up for some reason, show the setup button\n    if not isSetup then\n        createSetupButton()\n    end\nend\n\n-- Stops the saving timer, if it is running\nfunction stopSaveTimer()\n    if timerIsRunning then\n        Timer.destroy(self.getGUID())\n        timerIsRunning = false\n    end\nend\n\n-- Handler for the object's destroy event\nfunction onDestroy()\n    -- Destroy the linked FoW zone\n    destroyFoWZone()\n\n    -- Destroy the timer\n    stopSaveTimer()\nend\n\n-- Destroys the linked FoW zone. Does nothing if it does not exist\nfunction destroyFoWZone()\n    local fowZone = getObjectFromGUID(fowGuid)\n    if fowZone ~= nil then\n        fowZone.destruct()\n    end\nend\n\n-- Initializes the FoW zone from saved data\nfunction initFromSavedData(saved_data)\n    -- Parse it as JSON\n    local loaded_data = JSON.decode(saved_data)\n\n    -- Check if the linked zone exists, and create it if it doesn't\n    local fowZone = getObjectFromGUID(loaded_data.fowGuid)\n    if fowZone == nil then\n        spawnFromJSON(loaded_data.json)\n    else\n        fowGuid = fowZone.getGUID()\n    end\n\n    -- Start saving the FoW zone's state regularly\n    startSaveTimer()\nend\n\n--Makes the setup button\nfunction createSetupButton()\n    self.clearButtons()\n    self.createButton({\n        label = \"Setup\",\n        click_function = \"buttonClick_setup\",\n        function_owner = self,\n        position = {0,0.3,0},\n        rotation = {0,180,0},\n        height = 350,\n        width = 800,\n        font_size = 250,\n        color = {0,0,0},\n        font_color = {1,1,1}\n    })\nend\n\n-- Handles clicks on the setup button\nfunction buttonClick_setup()\n    -- Lock the object so it isn't accidently moved. All the FoW buttons will move with it if it is\n    self.setLock(true)\n\n    -- Remove all existing buttons\n    self.clearButtons()\n\n    -- Create new buttons over each FoW zone\n    createButtonsOnAllFoWObjects()\nend\n\n--Creates selection buttons on FoW zones. Mostly copied from the workshop item \"FoW on a tray\"\nfunction createButtonsOnAllFoWObjects()\n    local numberOfButtons = 0\n    for _, obj in ipairs(getAllObjects()) do\n        if obj.name == \"FogOfWar\" then\n            numberOfButtons = numberOfButtons+1\n            local objGUID = obj.getGUID()\n            --On a normal bag, the button positions aren't the same size as the bag.\n            globalScaleFactor = 1 * 1/self.getScale().x\n            --Super sweet math to set button positions\n            local selfPos = self.getPosition()\n            local objPos = obj.getPosition()\n            local deltaPos = findOffsetDistance(selfPos, objPos, obj)\n            local objPos = rotateLocalCoordinates(deltaPos, self)\n            objPos.x = -objPos.x * globalScaleFactor\n            objPos.y = objPos.y * globalScaleFactor\n            objPos.z = objPos.z * globalScaleFactor\n            --Offset rotation of bag\n            local rot = self.getRotation()\n            rot.y = -rot.y + 180\n            --Create the button\n            local funcName = \"selectButton_\" .. objGUID\n            local func = function() linkWithFoWZone(objGUID) end\n            self.setVar(funcName, func)\n            self.createButton({\n                click_function=funcName,\n                function_owner=self,\n                position=objPos,\n                rotation=rot,\n                height=500,\n                width=500,\n                color={0.75,0.25,0.25,0.6},\n            })\n        end\n    end\n\n    if numberOfButtons == 0 then\n        print(\"No FoW zones found\")\n        createSetupButton()\n    end\nend\n\n--Find delta (difference) between 2 x/y/z coordinates. Copied from the workshop item \"FoW on a tray\"\nfunction findOffsetDistance(p1, p2, obj)\n    local deltaPos = {}\n    local bounds = obj.getBounds()\n    deltaPos.x = (p2.x-p1.x)\n    deltaPos.y = (p2.y-p1.y) + (bounds.size.y - bounds.offset.y)\n    deltaPos.z = (p2.z-p1.z)\n    return deltaPos\nend\n\n--Used to rotate a set of coordinates by an angle. Copied from the workshop item \"FoW on a tray\"\nfunction rotateLocalCoordinates(desiredPos, obj)\n    local objPos, objRot = obj.getPosition(), obj.getRotation()\n    local angle = math.rad(objRot.y)\n    local x = desiredPos.x * math.cos(angle) - desiredPos.z * math.sin(angle)\n    local z = desiredPos.x * math.sin(angle) + desiredPos.z * math.cos(angle)\n    --return {x=objPos.x+x, y=objPos.y+desiredPos.y, z=objPos.z+z}\n    return {x=x, y=desiredPos.y, z=z}\nend\n\n-- Spawns a FoW zone from a JSON string and links it to this object\nfunction spawnFromJSON(json)\n    spawnObjectJSON({\n        json = json,\n        callback_function = function(obj) linkWithFoWZone(obj.getGUID()) end\n    })\nend\n\n--Links the FoW handler with a FoW zone\nfunction linkWithFoWZone(guid)\n    -- Remove all buttons this object has created\n    self.clearButtons()\n\n    -- Store the FoW zone's GUID\n    fowGuid = guid\n\n    -- Start saving the FoW zone's state regularly\n    startSaveTimer()\nend\n\n-- Starts the saving timer, if it is not already running\nfunction startSaveTimer()\n    if not timerIsRunning then\n        timerIsRunning = true\n        Timer.create({\n            identifier = self.getGUID(),\n            repetitions = 0, -- Infinite\n            function_name = \"saveState\",\n            delay = 3\n        })\n    end\nend\n\n-- Saves the state of the FoW zone to the GM description of the handler\nfunction saveState()\n    local fowZone = getObjectFromGUID(fowGuid)\n    if fowZone ~= nil then\n        self.setGMNotes(JSON.encode({\n           fowGuid = fowGuid,\n           json = fowZone.getJSON()\n        }))\n    else\n        print(\"Could not find FoW zone linked to \\\"\" .. self.getName() .. \"\\\". Was it deleted? If that was intended, please also delete the corresponding FoW token\")\n        stopSaveTimer()\n    end\nend\n",
          "LuaScriptState": "",
          "XmlUI": "",
          "GUID": "1644b3"
        }
      ],
      "GUID": "f4989b"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": -4.481455,
        "posY": 1.03000057,
        "posZ": 10.3655663,
        "rotX": 6.857806E-07,
        "rotY": -0.00224324223,
        "rotZ": 3.45669969E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Fog-of-War Chips 1/2",
      "Description": "The chips in this bag have the power to create and destroy Fog-of-War (FoW) zones.\n\nFirst, you need to set them up. Create a FoW zone, pick a chip from the bag, and click \"Setup\" on the chip. A red button then appears on the FoW zone. Click it, and the zone is linked to the chip\n\nThe chip does not need to be in the zone",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "351805"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": 4.054628,
        "posY": 1.03000057,
        "posZ": 10.3463659,
        "rotX": -8.647898E-06,
        "rotY": 2.83544323E-05,
        "rotZ": -1.66688631E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Fog-of-War Chips 2/2",
      "Description": "After linking a chip to a FoW zone, the zone will be destroyed then the chip is put in a bag or otherwise removed from the game.\n\nThe FoW zone will be recreated once the chip starts existing again, for example when being pulled out from a bag\n\nYou should name the chips so you know what they control, but it is not necessary",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "84d9f3"
    },
    {
      "Name": "Notecard",
      "Transform": {
        "posX": -0.111283824,
        "posY": 1.03000009,
        "posZ": 5.35966635,
        "rotX": -2.51741426E-06,
        "rotY": 7.11592838E-06,
        "rotZ": 4.815799E-06,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "One World Compatible!",
      "Description": "Place a FoW zone on the big map in One World. Place a chip on the map. Link the chip to the zone, and pack it.\n\nThe FoW zone will then be created when the map is loaded, and be removed when it is unloaded again!\n\nBut note that the map must be packed for the state of the zone to be saved",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "GUID": "46cb78"
    }
  ],
  "LuaScript": "--[[ Lua code. See documentation: https://api.tabletopsimulator.com/ --]]\n\n--[[ The onLoad event is called after the game save finishes loading. --]]\nfunction onLoad()\n    --[[ print('onLoad!') --]]\nend\n\n--[[ The onUpdate event is called once per frame. --]]\nfunction onUpdate()\n    --[[ print('onUpdate loop!') --]]\nend",
  "LuaScriptState": "",
  "XmlUI": "<!-- Xml UI. See documentation: https://api.tabletopsimulator.com/ui/introUI/ -->",
  "VersionNumber": "v12.4.3"
}